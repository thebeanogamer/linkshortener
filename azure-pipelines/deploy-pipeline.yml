trigger:
- master
- releases/*

jobs:
- job: Deploy
  displayName: Deploy

  pool:
    vmImage: Ubuntu 18.04

  steps:
  - task: NodeTool@0
    displayName: 'Use Node 12.x'
    inputs:
      versionSpec: 12.x

  - task: Npm@1
    displayName: 'Install Node Packages'
    inputs:
      workingDir: '$(System.DefaultWorkingDirectory)/_thebeanogamer_linkshortener'
      verbose: false

  - script: |
      mkdir ~/.aws
      echo $AWSKEYS | base64 -d > ~/.aws/credentials
    displayName: 'Setup Environment'

  - script: 'serverless deploy --conceal --stage prod'
    displayName: 'Deploy with Serverless Framework'
